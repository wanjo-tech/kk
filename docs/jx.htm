<h1>jx = web-js template-engine by datakk</h1>
<h3>DOC&TESTER=<a href="https://kk.datakk.com/jx.htm" target=_blank>https://kk.datakk.com/jx.htm</a><h3>
<h3>CODE=<a href="https://github.com/wanjo-tech/kk/blob/main/docs/jx.js" target=_blank>https://github.com/wanjo-tech/kk/blob/main/docs/jx.js</a><h3>
<h3>CDN=https://static.datakk.com/jx.js<h3>
<script src='jx.js'></script>
<script>
var {s2bdy,jxTryEval,jxBuild,jxUpsert,s2el,s2o}=jx()
var now = () => new Date().getTime()/1000;
var gData = {}
function Build(){
  var data_s = stageData.value
  //console.log('data_s',data_s)
  var data = jxTryEval(`(${data_s})`,{},console.log)
  Object.assign(gData,data)
  //console.log('data',data)
  //var template = tpl.innerHTML
  //var template = tplStage.textContent
  template = tplStage.value
  //console.log('template',template)
var t0=now()
  var elTemplate = s2bdy(template);
var t1=now()
  //var built = jxBuild(elTemplate, data);
  var built = jxBuild(elTemplate, gData);
var t2=now()
  var s = built.innerHTML
var t3=now()
  stageCode.value=s
var t4=now()
  stageDebug.value=JSON.stringify(['compile',t1-t0,'jxBuild',t2-t1,'2s',t3-t2,'show',t4-t3])
  return built 
}
function Render(){
var t0=now()
  //jxUpsert(divStage,Build())
  var data = jxTryEval(`(${stageData.value})`)
  Object.assign(gData,data)
  //jxUpsert(divStage,jxBuild(s2bdy(tplStage.value),jxTryEval(`(${stageData.value})`)))
  jxUpsert(divStage,jxBuild(s2bdy(tplStage.value),gData))
var t1=now()
  //stageDebug.textContent+=`=>Render ${t1-t0}`
  stageDebug.value+=`=>Render ${t1-t0}`
}
</script>
<h3>DESIGN-PATTERN=(evt,data)=>(update(data,evt),render(tpl,data))
<h3>DEBUG:[...document.querySelectorAll('[j-err],[j-warn]')].map(console.log)</h3>
</h3>
<hr/>
<button onclick='Build()'>Build</button> <button onclick='Render()'>Render</button> tpl=
<br/>
<!-- <template id='tpl'> <script>console.log(1234)</script> </template> -->
<textarea id='tplStage' style="border:1px solid;min-width:640px;min-height:150px">
<br/>test @change <input @change='alert(this.value)' value='abcd'/>
<h3 j-expr>{{thisDate}}</h3>
<div j-for="val,key,idx in wtf"><li><span j-eval>idx+","+key+":"+val</span></li></div>
<font>不解析内部 {{ new Date() }}</font>
<font j-expr>解释内部 {{ new Date() }}</font>
<font j-expr>解释内部语法错误 {{ new XXX() }}</font>
<font j-eval>new Date()</font>
<span j-eval>"Hello"+ " "</span>
<span j-eval>测试语法错误1</span>
<div j-if="f1">
  <font color=red>第一层是的</font>
  <div j-else><font color=blue>第一层不是</font></div>
</div>
<div j-if="true"><font color=green>第一层可以
  <div j-if="f2a">第二层f2a</div>
  <div j-if="f2b">第二层f2b</div>
</font></div>
<div j-for="错误 in items"><li><span j-eval>idx+","+key+":"+val</span></li></div>
<div j-for="(val,key,idx) in items"><li><span j-eval>idx+","+key+":"+val</span></li></div>
<div j-for="val,key,idx in items"><li><span j-eval>idx+","+key+":"+val</span></li></div>
<div j-for="(val,key,idx) in itemsb">
  <li><span j-eval>idx+","+key+":"+val</span></li>
</div>
<div j-for="(val,key) in itemsb"><li><span j-eval>key+":"+val</span></li></div>
<div j-for="val,key in itemsb"><li><span j-eval>key+":"+val</span></li></div>
<div j-for="(val) in itemsb"><li><span j-eval>val</span></li></div>
<div j-for="val in itemsb"><li><span j-eval>val</span></li></div>
<div j-for="val in itemsb"><li><span j-eval>测试语法错误2</span></li></div>

</textarea>
<br/>data=<br/>
<textarea id='stageData' style='border:1px solid;min-width:640px;min-height:50px'>
{thisDate:new Date(), items: ["Apple", "Banana", "Cherry"], itemsb:{Apple:222,Banana:333,Cherry:444}, f2b:true}
</textarea>
<br/>debug=<br/>
<textarea id='stageDebug' style='border:1px solid;min-width:640px;min-height:30px'></textarea>
<br/>Build=<br/>
<textarea id='stageCode' style='border:1px solid;min-width:640px;min-height:150px'></textarea>
<br/>render=<br/>
<div style='border:1px solid;width:99%;' id='divStage'></div>
<!--
cancelled:
    if (theAttribute=node.getAttribute?.('j-bind')) {
      if (node.tagName === 'INPUT' || node.tagName === 'TEXTAREA') {
        returnNode.value = data[theAttribute] || '';
        bindings.push({ propName: theAttribute, element: returnNode });
        returnNode.addEventListener('input', (event) => {
console.log('input',event.target.value)
          data[theAttribute] = event.target.value;
          bindings.forEach(binding => {
            if (binding.propName === theAttribute && binding.element !== event.target) {
console.log('binding',binding)
              binding.element.value = event.target.value;
            }
          });
        });
      }
    }

-->
